<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/especialidades.css">
    <link rel="icon" type="image/png" href="/img/logoCMD.png">

    <title>Consultorios MÃ©dicos David</title>
</head>

<body class="text-body">
    <%- include('partials/header') %>

        <main>
            <div class="col">
                <h1> Nuestras Especialidades </h1>
                <div>
                    <div class="row">
                        <div class="col especialidadBox" id="container">

                        </div>
                    </div>
                </div>
            </div>
        </main>


        <%- include('partials/footer') %>
            <script>
                window.addEventListener('load', () => {
                    let container = document.getElementById('container')

                    fetch('http://localhost:3005/especialidades/api').then(res => {
                        return res.json()
                    }).then(r => {
                        for (let i = 0; i < r.data.length; i++) {
                            const e = r.data[i];
                            const profesional = e.especialidad;

                            container.innerHTML += `
                    <h2>${e.nombre.toUpperCase()}</h2>
                    <div id="medicos${i}" class="mb-5"></div>`
                            let p = 'medicos' + [i]
                            let medicos = document.getElementById(p)
                            console.log(medicos)
                            if (e.especialidad.length > 0) {
                                if (profesional.length > 1) {
                                    for (let l = 0; l < profesional.length; l++) {
                                        const medico = profesional[l];

                                        let prof = {
                                            nombre: medico.nombre,
                                            apellido: medico.apellido,
                                            sexo: medico.sexo ? 'Masculino' : 'Femenino'
                                        }

                                        let prefix = prof.sexo == 'Masculino' ? 'Dr.' : 'Dra.'
                                        medicos.innerHTML += `<p>${prefix} ${prof.nombre} ${prof.apellido}</p>`
                                    }
                                } else {

                                    let prof = {
                                        nombre: e.especialidad[0].nombre,
                                        apellido: e.especialidad[0].apellido,
                                        sexo: e.especialidad[0].sexo ? 'Masculino' : 'Femenino'
                                    }

                                    let prefix = prof.sexo == 'Masculino' ? 'Dr.' : 'Dra.'

                                    medicos.innerHTML += `<p>${prefix} ${prof.nombre} ${prof.apellido}</p>`
                                }
                            } else {
                                medicos.innerHTML = `<p> No disponible actualmente</p>`
                            }
                        }
                    })
                })
            </script>
</body>

</html>